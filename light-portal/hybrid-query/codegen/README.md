### Light Portal Hybrid Query Server

This is the [light-hybrid-4j](https://github.com/networknt/light-hybrid-4j) 
server generated by [light-codegen](https://github.com/networknt/light-codegen) 
to host all portal query services that rely on cloud eventuate platform and 
databases.
 
Please note that we only use the generator once and will maintain hybrid-query
server module manually afterward. There are some changes that cannot be override
with the light-codegen. 
 
The config.json can be found in [model-config](https://github.com/networknt/model-config) 
repo at https://github.com/networknt/model-config/tree/master/hybrid/portal-server 


The command to generate the server:

```
cd ~/networknt/light-codegen
java -jar codegen-cli/target/codegen-cli.jar -f light-hybrid-4j-server -o ~/networknt/light-portal/hybrid-server -c ~/networknt/model-config/hybrid/portal-server/config.json
```

Please note that you have to checkout [model-config](https://github.com/networknt/model-config) 
and [light-portal](https://github.com/networknt/light-portal) in the same workspace
networknt. And make sure you run the command in [light-codegen](https://github.com/networknt/light-codegen)
folder in the same workspace. Above command assume that the workspace is ~/networknt


### Start server

For light-portal, we put all light-hybrid-4j query services into parent service folder 
as a list of jar files. When we start the light-hybrid-4j server, we need to include
these jars in the classpath. 

If you are developing hybrid services for light-portal, you should use the test server
in test folder to test your service locally. If you do want to run your service with
this server, please update the command line below to add the jar file from your project

The following command line to start the server with all the services in service
folder. The command line should be executed in the folder that contains this README.md

```
cd ~/networknt/light-config-test/light-portal/hybrid-query/cloud/
cp ~/networknt/light-portal/docker/hybrid-query/service/*.jar ../service
java -Dlight-4j-config-dir=./config -Dlogback.configurationFile=./logback.xml -cp ../service/hybrid-query-1.5.11.jar:../service/* com.networknt.server.Server
```

If there are any service injections needed for your service, you need to update service.yml
to add these services before starting the command line. 

### Test

Given that light-codegen/codegen-web is one of the services, to ensure your hybrid-server
is working, we are going to call one of the action in codegen-web to verify if the server
is functioning.

```
curl -k -X POST \
  https://localhost:8082/api/json \
  -H 'cache-control: no-cache' \
  -d '{"host":"lightapi.net","service":"codegen","action":"listFramework","version":"0.0.1"}'
```

and the expected result should be

```
["light-hybrid-4j-server","light-graphql-4j","openapi","light-hybrid-4j-service","swagger"]
```
